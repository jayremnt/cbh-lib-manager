<template>
    <div class="page">
        <div class="page-content">
            <section class="admin-content">
                <div class="container py-5">
                    <div class="col-md-15">
                        <div class="card m-b-30">
                            <div class="card-header">
                                <h5 class="m-b-0">
                                    Quản lí dự án
                                </h5>
                                <div class="card-controls">
                                    <a href="/manage/projects/create/" class="btn btn-info">Tạo dự án mới</a>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover ">
                                        <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Tên</th>
                                            <th>Nền tảng</th>
                                            <th>Lựa chọn</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        ${allProjects.map(project => $h`
                                        <tr>
                                            <td>${project.id}</td>
                                            <td>${project.title}</td>
                                            <td>${project.platform}</td>
                                            <td>
                                                <a href="/manage/projects/${project.id}/edit/"
                                                   class="btn btn-info projects" role="button">
                                                    <i class="mdi mdi-pencil-outline"></i>
                                                </a>
                                                <a href="/manage/projects/${project.id}/participants/"
                                                   class="btn btn-outline-info projects">
                                                    <i class="mdi mdi-view-list"></i>
                                                </a>
                                                <button @click="${deleteProject}" type="button" class="btn btn-danger"
                                                        data-toggle="modal" data-target="#deleteProject"
                                                        data-id="${project.id}">
                                                    <i class="mdi mdi-delete"></i>
                                                </button>

                                            </td>
                                        </tr>
                                        `)}
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
</template>
<script>
	import Mext from "../../js/mext";
	import Framework7 from "../../js/framework7-custom";
	import Utils from "../../js/utils/utils";
	import CONSTANTS from "../../js/constants";
	import {t} from "../../js/mext";

	export default function (props, {$f7, $on, $update, $onBeforeMount, $onMounted, $onBeforeUnmount, $onUnmounted}) {
		let allProjects = [];

		const resetList = (e) => {
            Mext.api("get_all_projects").then(response => {
                allProjects = response.data;
                $update();
            });
        }

        resetList();

		const deleteProject = (e) => {
            let projectID = e.currentTarget.dataset.id;

			Mext.openConfirmModal('deleteProject').then(isConfirmed => {
				if (!isConfirmed) return;

				Mext.api("delete_project", {
					id: projectID
				}).then(response => {
					Mext.alert("Tester Portal", response.message);

					resetList();
				});
			});
		}
		// Return render function
		return $render;
	}
</script>