<template>
  <div class="page">
    <div class="page-content">
      <section class="admin-content">
        <div class="container py-5">
          <div class="card m-b-30">
            <div class="card-header">
              <h5 class="m-b-0">
                Thông tin sách
              </h5>
            </div>
            <div class="card-body">
              ${alert && $h`
              <div class="form-group">
                <div class="alert alert-danger" role="alert">
                  ${returnMessage}
                </div>
              </div>
              `}
              <div class="table-responsive">
                <table class="table table-hover ">
                  <thead>
                  <tr>
                    <th>Tên sách</th>
                    <th>Tác giả</th>
                    <th>Mã sách</th>
                    <th>Vị trí</th>
                    <th>Giá tiền</th>
                    <th>Ngày nhập</th>
                    <th>Người nhập</th>
                    <th>Tình trạng</th>
                    <th>Hành động</th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr>
                    <td>${book.name}</td>
                    <td>${book.author}</td>
                    <td>${book.code}</td>
                    <td>${book.location}</td>
                    <td>${book.cost}</td>
                    <td>${Clm.timeConverter(book.imported_time)}</td>
                    <td>${book.responsible_person ? book.responsible_person.name : ""}</td>
                    <td>${(book.borrowed_info[0] && book.borrowed_info[0].is_borrowed) ? "Đã mượn" : "Chưa mượn"}</td>
                    <td>
                      <a class="btn btn-primary btn-sm" href="#">
                        <i class="mdi mdi-pencil"></i>
                      </a>
                      ${(book.borrowed_info[0] && book.borrowed_info[0].is_borrowed) && $h`
                      <a href="/borrowers/info/${book.borrowed_info[0].borrower.student_code}/" class="btn btn-primary btn-sm"
                         role="button">
                        <i class="mdi mdi-human-male"></i>
                      </a>
                      `}
                    </td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>
</template>

<script>
	import Clm from "../../js/clm";

	export default function (props, {$f7, $on, $update, $onBeforeMount, $onMounted, $onBeforeUnmount, $onUnmounted}) {
		const bookCode = props.bookCode;

		let book = {
			responsible_person: {},
			borrowed_info: {
				borrower: {}
      }
		};
		let alert = false;
		let returnMessage = "";

		const resetInfo = async function () {
			try {
				let response = await Clm.api("books/" + bookCode);
				console.log(response);
				if (!response.error) {
					alert = false;
					book = response.data.book_details;
				}
				else {
					alert = true;
					returnMessage = response.message;
				}
			}
			catch (e) {
				console.log(e);
				alert = true;
				returnMessage = "Có lỗi xảy ra";
			}
			$update();
		}

		resetInfo();
		return $render;
	}
</script>